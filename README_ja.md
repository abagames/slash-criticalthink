# slash-criticalthink

[English](README.md) | 日本語

## 概要

現代の LLM（大規模言語モデル）は、自信に満ちた、一見もっともらしい回答を生成することに長けている。しかし、その回答はしばしば現実世界の制約を無視したり、論理的な欠陥を内包している。

`criticalthink`コマンドは、AI が持つ「肯定バイアス」や、人間が AI の回答を盲信する「権威バイアス」への対抗策として、対話プロセスそのものに健全な懐疑主義を組み込むカスタムコマンドである。AI 自身に、直前の回答を批判的に分析させることで、隠れた前提や見落とされたリスクを明らかにする。

### 想定読者

- コーディングエージェント（Claude Code / Codex CLI 等）を日常的に使う開発者
- AI の提案を鵜呑みにせず、批判的に検証したい技術者

## セットアップ

### オプション 1: 手動インストール

1. 使用するツールに応じてコマンドファイルを配置:

   - **Claude Code**: `.claude/commands/criticalthink.md` (プロジェクトルートまたはホームディレクトリ)
   - **Codex CLI**: `~/.codex/prompts/criticalthink.md` (ホームディレクトリ)
   - **Gemini CLI**: `.gemini/commands/criticalthink.toml` (プロジェクトルート)

2. ディレクトリを作成してファイルをコピー:

   Claude Code の場合:

   ```bash
   mkdir -p .claude/commands
   cp criticalthink.md .claude/commands/
   ```

   Codex CLI の場合:

   ```bash
   mkdir -p ~/.codex/prompts
   cp criticalthink.md ~/.codex/prompts/
   ```

   Gemini CLI の場合:

   ```bash
   mkdir -p .gemini/commands
   cp commands/criticalthink.toml .gemini/commands/
   ```

### オプション 2: プラグインマーケットプレース経由でインストール (Claude Code 向け)

Claude Code 内で以下のコマンドを実行:

1. このリポジトリをプラグインマーケットプレースに追加:

   ```
   /plugin marketplace add https://github.com/abagames/slash-criticalthink.git
   ```

2. criticalthink コマンドをインストール:

   ```
   /plugin install criticalthink
   ```

### オプション 3: Gemini CLI 拡張機能としてインストール (Gemini CLI 向け)

GitHub から直接インストール:

```bash
gemini extensions install https://github.com/abagames/slash-criticalthink
```

### インストールの確認

インストール後、ツールを再起動して動作確認:

```
User: 2 + 2 は？
AI: 4
User: /criticalthink
```

批判的分析が開始されれば成功

## 使い方

### 基本的な使い方

AI が回答を生成した直後に `/criticalthink` と入力する。AI は直前の自分の回答を以下の観点で分析する：

- 前提条件の妥当性
- 論理的整合性
- 見落とされたリスク
- AI 特有の失敗パターン（問題回避、ハッピーパスバイアス、過剰設計、ハルシネーション等）

### 使用例

#### ケース 1: 複雑なアーキテクチャ提案を受けた時

```
User: マイクロサービス化したいんだけど、どう設計すべき？
Claude: Kubernetes + Istio + gRPC で以下のような構成を提案します...
       [詳細な設計案]
User: /criticalthink
Claude: ### 1. Core Thesis & Confidence Score (Initial)
       - **1-1. Core Thesis:** マイクロサービス化には Kubernetes ベースの
         フルスタックソリューションが最適である
       - **1-2. Initial Confidence:** 8/10

       ### 2. Foundational Analysis: Assumptions & Context
       - **2-1. High-Impact Assumptions:**
         1. チームに Kubernetes 運用経験がある
         2. トラフィック規模がオーケストレーション導入を正当化できる
         3. 初期投資コストと学習コストが許容される
       ...
```

#### ケース 2: 「完璧な解決策」と主張する回答を受けた時

```
User: この API のレート制限をどう実装する？
Claude: Redis + Sliding Window アルゴリズムで完璧に実装できます。
       以下のコードで...
User: /criticalthink
Claude: ### 3. AI-Specific Pitfall Analysis
       - **3-2. "Happy Path" Bias:** Fail
         理由: Redis 障害時のフォールバック戦略を一切考慮していない
       - **4-1. Overlooked Risks:**
         1. Redis が SPOF（単一障害点）になる
         2. ネットワーク遅延が全リクエストに影響
         3. Redis のメモリ使用量見積もりが未実施
       ...
```

#### ケース 3: 既存コードの大幅なリファクタリングを提案された時

```
User: このレガシーコードをモダンにしたい
Claude: すべて TypeScript + React Hooks で書き直しましょう...
User: /criticalthink
Claude: ### 3. AI-Specific Pitfall Analysis
       - **3-3. Over-Engineering:** Fail
         理由: 段階的移行ではなく全面書き直しを提案している
       - **4-2. Alternative Scenarios:**
         段階的な移行戦略: まず型定義ファイル (.d.ts) を追加し、
         クリティカルパスから順次 TypeScript 化する方が
         ビジネスリスクとコストを抑えられる
       ...
```

#### ケース 4: 検証なしで情報要約を受けた時

```
User: README.md をレビューして
Claude: このREADMEは slash-criticalthink について説明しています...
       [内容の要約]
User: /criticalthink
Claude: ### 2. Foundational Analysis: Assumptions & Context
       - **2-1. High-Impact Assumptions:**
         1. ユーザーが特定の情報抽出ではなく要約を求めていると仮定
         2. criticalthink.md ファイルがこのリポジトリに実在すると仮定
         3. ユーザーがスラッシュコマンドが何かを理解していると仮定
       - **2-2. Contextual Integrity:** ユーザーの意図を明確化せずに仮定した:
         「レビュー」は、要約、品質分析、エラーチェック、完全性確認、
         使用/修正の準備など、様々な意味を持ちうる

       ### 3. AI-Specific Pitfall Analysis
       - **3-2. "Happy Path" Bias:** Fail
         理由: criticalthink.md が実在するか、.claude/commands/ ディレクトリが
         存在するかの検証を行っていない

       ### 5. Synthesis & Revised Recommendation
       - **5-3. Actionable Next Step:** まず、READMEのどの側面をレビューしたいか
         明確にする: (a) 内容要約（完了）、(b) スラッシュコマンドがインストール済み
         で動作するか検証、(c) ドキュメント品質の批評、(d) セットアップ/使用の支援
```

### 不要な分析の履歴削除（推奨）

`/criticalthink` コマンドは AI に自己批判させるため、**誤った懸念や過剰な否定的分析が対話履歴に残り、その後の AI の思考を歪める**リスクがある（コンテキスト汚染）。

これを避けるため、以下のワークフローを推奨する：

1. AI から提案を受ける
2. `/criticalthink` で批判的分析を実行
3. 分析結果を吟味
4. **分析が不要だった場合、`Esc-Esc` で前のメッセージに巻き戻し**、`/criticalthink` 実行前に戻る（批判的分析を履歴から削除）
5. 新しい質問を続けるか、AI に改善を依頼

これにより、批判的思考の利点を享受しつつ、コンテキスト汚染を回避できる。

## 設計思想

### 一般的フレームワーク

あらゆる主張に適用可能な、一般的な批判的思考のフレームワークを基盤とする。

- **主張の特定:** AI 自身の回答の要点を特定する
- **前提の洗い出し:** 回答の背後にある暗黙の仮定を暴く
- **論理的誤謬の検証:** 論理的な飛躍や矛盾がないかを探す
- **代替案の提示:** 考慮されなかった別の視点や解決策を提示する

### AI 特有の失敗パターン分析

一般的フレームワークだけでは「形式的で表面的な批判」に陥るリスクがあった。これを克服するため、LLM やコーディングエージェントが陥りがちな特有の失敗パターンを分析項目に組み込んだ。

- **問題回避:** モックやプレースホルダーで中核的な問題を解決したかのように見せかけていないか
- **ハッピーパスへの固執:** エラー処理やエッジケースを無視していないか
- **過剰設計:** 不必要なライブラリや複雑な解決策を提案していないか
- **ハルシネーション:** 存在しない関数や API を捏造していないか
- **コンテキスト無視:** 過去の対話の制約を無視していないか

これらの項目に対し、コマンドは AI に Pass/Fail の明示的な自己評価を求める。

## 注意事項と限界

### 思考の補助輪として使う

このコマンドは、自分の考えの穴を見つけるための補助線である。AI の批判的分析を「正解」として扱うのではなく、新たな視点を得るためのツールとして活用すること。

### 責任の所在

最終的な判断を下すのは常に人間である。AI の批判もまた、批判的に吟味されるべき一つの生成物に過ぎない。特に以下の点に注意：

- AI は自分の回答の誤りを完全に認識できるわけではない
- 批判的分析自体が新たなバイアスを生む可能性がある
- 過度に保守的な指摘（実際には問題ない箇所への警告）も含まれうる

### 相互批判の精神

ユーザーは AI の回答を疑い、同時に AI（とコマンド）を使って自分自身の前提やバイアスをも疑う。この相互批判のプロセスが、より堅牢な意思決定につながる。

### パフォーマンスへの影響

批判的分析は追加のトークンを消費し、応答時間が長くなる。すべての回答に適用するのではなく、以下のような重要な判断の前に選択的に使用することを推奨：

- アーキテクチャの決定
- 大規模なリファクタリング
- セキュリティやパフォーマンスに関わる実装
- 外部依存関係の導入

## 関連研究: CQoT との比較

AI に自己批判的なプロセスを導入し、その推論能力を向上させるアプローチは、学術研究の分野でも注目されている。特に、Federico Castagna らによる論文「Critical-Questions-of-Thought (CQoT)」が良く知られている。

### 共有する目的

CQoT と`/criticalthink`は、「AI にメタ認知的な自己評価を行わせることで、出力の質と信頼性を向上させる」という共通の目的を持つ。どちらも単一の回答を生成して終わりにするのではなく、その背後にある推論プロセスを検証するステップを導入する点で共通している。

### アプローチの根本的な違い

両者は共有する目的を持ちつつも、その目的と方法論において異なる。

| 比較項目       | **CQoT (論文)**                                                 | **`/criticalthink` (本ツール)**                                                 |
| :------------- | :-------------------------------------------------------------- | :------------------------------------------------------------------------------ |
| **主目的**     | **論理的な正しさ (Logical Soundness) の追求**                   | **実用的な妥当性 (Practical Viability) の検証**                                 |
| **適用領域**   | 数学の問題、論理パズルなど、**正解が明確な領域**                | ソフトウェア設計、リファクタリングなど、**トレードオフが存在する領域**          |
| **タイミング** | 回答生成**前**の**統合的・自動化パイプライン**                  | 回答生成**後**の**Post-hoc（後付け）分析ツール**                                |
| **評価基準**   | 普遍的な論理原則<br>（例: 前提は明確か？ 結論は導出されるか？） | AI と開発に特化した失敗パターン<br>（例: ハッピーパスバイアス、過剰設計、SPOF） |

### `/criticalthink`の独自性

要約すると、CQoT が AI をより優れた**「論理学者」**にすることを目指すのに対し、`/criticalthink`は AI を開発者のためのより賢明な**「設計レビューパートナー」**にすることを目指す。本ツールは、理論的な正しさだけでは測れない、開発現場で直面する現実的なリスク、コスト、そして代替案といったトレードオフを洗い出すことに特化している。CQoT が推論プロセスの欠陥を自動で修正するクローズドループであるのに対し、`/criticalthink`は人間が最終判断を下すためのインサイトを提供するオープンループなツールである。
